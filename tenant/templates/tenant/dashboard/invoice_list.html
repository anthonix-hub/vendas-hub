{% extends "tenant/dashboard/dashboard_base.html" %}
{% load static %} {# Ensure static is loaded if you use static assets #}
{% load humanize %} {# Load humanize for better number formatting #}

{% block content %}
<div class="container mx-auto p-4 md:p-6 mt-10">
    <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
        <h1 class="text-2xl font-bold text-gray-800">Invoices</h1>
        {# Optional: Add a button to create a new invoice #}
        <a href="{% url 'tenant:create_manual_invoice' %}" class="w-full md:w-auto bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded text-center">
            Create Manual Invoice
        </a>
    </div>
    {# --- Filter Form --- #}
    <div class="mb-4 p-4 bg-gray-50 rounded-lg shadow-sm">
        <form method="get" action="{% url 'tenant:invoice_list' %}" class="flex flex-col md:flex-row gap-4"> {# Added action URL #}
            <input type="text" name="search" placeholder="Search by Invoice #, Order ID, Customer..."
                   class="flex-grow px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                   value="{{ search_query }}"> {# Use context variable #}
            <select name="status" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                <option value="">All Statuses</option>
                <option value="paid" {% if status_filter == 'paid' %}selected{% endif %}>Paid</option> {# Use context variable #}
                <option value="unpaid" {% if status_filter == 'unpaid' %}selected{% endif %}>Unpaid</option> {# Use context variable #}
            </select>
            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded">
                Filter
            </button>
             {# Optional: Clear filters button #}
            {% if search_query or status_filter %}
            <a href="{% url 'tenant:invoice_list' %}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded text-center">
                Clear
            </a>
            {% endif %}
        </form>
    </div>

    {# Table container for responsiveness #}
    <div class="bg-white shadow-md rounded-lg overflow-x-auto ">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Invoice #
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell"> {# Hide on extra small screens #}
                        Order ID
                    </th>
                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Amount
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell"> {# Hide on small/medium screens #}
                        Created At
                    </th>
                     <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Status
                    </th>
                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Actions
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {# Use the paginated object 'invoices' #}
                {% for invoice in invoices %}
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                        {{ invoice.invoice_number }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 hidden sm:table-cell"> {# Hide on extra small screens #}
                        {{ invoice.order.id }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">
                        â‚¦{{ invoice.total_amount|floatformat:2|intcomma }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 hidden md:table-cell"> {# Hide on small/medium screens #}
                        {{ invoice.created_at|date:"M d, Y" }} {# Simplified date format #}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                         <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full {% if invoice.is_paid %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                            {% if invoice.is_paid %}Paid{% else %}Unpaid{% endif %}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                        <a href="{% url 'tenant:invoice_detail' invoice.id %}" class="text-indigo-600 hover:text-indigo-900" title="View Details">
                            <i class="fas fa-eye"></i> <span class="hidden sm:inline">View</span> {# Icon + Text (optional hide text on mobile) #}
                        </a>
                        <a href="{% url 'tenant:download_invoice' invoice.id %}" class="text-blue-600 hover:text-blue-900" title="Download PDF" download>
                            <i class="fas fa-download"></i> <span class="hidden sm:inline">Download</span> {# Icon + Text (optional hide text on mobile) #}
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">
                        No invoices found matching your criteria. {# Updated empty message #}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {# --- Updated Pagination Controls --- #}
    {% if invoices.has_other_pages %}
        <div class="mt-6 flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 rounded-lg shadow-sm">
            {# Mobile Pagination #}
            <div class="flex flex-1 justify-between sm:hidden">
                {% if invoices.has_previous %}
                    <a href="?page={{ invoices.previous_page_number }}&{{ pagination_query_string }}" class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Previous</a>
                {% else %}
                    <span class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-400 cursor-not-allowed">Previous</span>
                {% endif %}
                {% if invoices.has_next %}
                    <a href="?page={{ invoices.next_page_number }}&{{ pagination_query_string }}" class="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Next</a>
                {% else %}
                    <span class="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-400 cursor-not-allowed">Next</span>
                {% endif %}
            </div>
            {# Desktop Pagination #}
            <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
                <div>
                <p class="text-sm text-gray-700">
                    Showing
                    <span class="font-medium">{{ invoices.start_index }}</span>
                    to
                    <span class="font-medium">{{ invoices.end_index }}</span>
                    of
                    <span class="font-medium">{{ invoices.paginator.count }}</span>
                    results
                </p>
                </div>
                <div>
                <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination">
                    {% if invoices.has_previous %}
                    <a href="?page=1&{{ pagination_query_string }}" class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                        <span class="sr-only">First</span>
                        <i class="fas fa-angle-double-left h-5 w-5"></i>
                    </a>
                    <a href="?page={{ invoices.previous_page_number }}&{{ pagination_query_string }}" class="relative inline-flex items-center px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                        <span class="sr-only">Previous</span>
                        <i class="fas fa-angle-left h-5 w-5"></i>
                    </a>
                    {% else %}
                    <span class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-300 ring-1 ring-inset ring-gray-300 cursor-not-allowed">
                        <span class="sr-only">First</span>
                        <i class="fas fa-angle-double-left h-5 w-5"></i>
                    </span>
                    <span class="relative inline-flex items-center px-2 py-2 text-gray-300 ring-1 ring-inset ring-gray-300 cursor-not-allowed">
                        <span class="sr-only">Previous</span>
                        <i class="fas fa-angle-left h-5 w-5"></i>
                    </span>
                    {% endif %}

                    {# Current Page Number (Add more page links logic if needed) #}
                    <span aria-current="page" class="relative z-10 inline-flex items-center bg-indigo-600 px-4 py-2 text-sm font-semibold text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                        {{ invoices.number }}
                    </span>

                    {% if invoices.has_next %}
                    <a href="?page={{ invoices.next_page_number }}&{{ pagination_query_string }}" class="relative inline-flex items-center px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                        <span class="sr-only">Next</span>
                        <i class="fas fa-angle-right h-5 w-5"></i>
                    </a>
                    <a href="?page={{ invoices.paginator.num_pages }}&{{ pagination_query_string }}" class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                        <span class="sr-only">Last</span>
                        <i class="fas fa-angle-double-right h-5 w-5"></i>
                    </a>
                    {% else %}
                     <span class="relative inline-flex items-center px-2 py-2 text-gray-300 ring-1 ring-inset ring-gray-300 cursor-not-allowed">
                        <span class="sr-only">Next</span>
                        <i class="fas fa-angle-right h-5 w-5"></i>
                    </span>
                    <span class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-300 ring-1 ring-inset ring-gray-300 cursor-not-allowed">
                        <span class="sr-only">Last</span>
                        <i class="fas fa-angle-double-right h-5 w-5"></i>
                    </span>
                    {% endif %}
                </nav>
                </div>
            </div>
        </div>
    {% endif %}

</div>
{% endblock %}
